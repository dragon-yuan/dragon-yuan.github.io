---
title: CentOS 6、7下PPTP VPN.sh
categories:
  - Operations
date: 2015-11-20 05:44:16
---

<pre class="prettyprint lang-bsh" style="box-sizing: inherit; border-width: 0px 0px 0px 3px; border-left-style: solid; border-left-color: #cccccc; padding: 0.5em; overflow: auto; word-wrap: normal; font-size: 15.3999996185303px; line-height: 1.55; font-family: Consolas, Monaco, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace; background-color: #f0f0f0;"><span class="com" style="box-sizing: inherit; color: #880000;">#!/bin/bash</span>
<span class="com" style="box-sizing: inherit; color: #880000;">#</span>
<span class="com" style="box-sizing: inherit; color: #880000;"># Author:  yeho <lj2007331 AT gmail.com></span>
<span class="com" style="box-sizing: inherit; color: #880000;"># Blog:  http://blog.linuxeye.com</span>
<span class="com" style="box-sizing: inherit; color: #880000;">#</span>
<span class="com" style="box-sizing: inherit; color: #880000;"># Installs a PPTP VPN-only system for CentOS</span>

<span class="com" style="box-sizing: inherit; color: #880000;"># Check if user is root</span>
<span class="pun" style="box-sizing: inherit; color: #666600;">[</span> <span class="pln" style="box-sizing: inherit; color: #000000;">$</span><span class="pun" style="box-sizing: inherit; color: #666600;">(</span><span class="pln" style="box-sizing: inherit; color: #000000;">id</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">u</span><span class="pun" style="box-sizing: inherit; color: #666600;">)</span> <span class="pun" style="box-sizing: inherit; color: #666600;">!=</span> <span class="str" style="box-sizing: inherit; color: #008800;">"0"</span> <span class="pun" style="box-sizing: inherit; color: #666600;">]</span> <span class="pun" style="box-sizing: inherit; color: #666600;">&&</span> <span class="pln" style="box-sizing: inherit; color: #000000;">echo</span> <span class="str" style="box-sizing: inherit; color: #008800;">"Error: You must be root to run this script"</span> <span class="pun" style="box-sizing: inherit; color: #666600;">&&</span> <span class="pln" style="box-sizing: inherit; color: #000000;">exit</span> <span class="lit" style="box-sizing: inherit; color: #006666;">1</span> <span class="pln" style="box-sizing: inherit; color: #000000;">export PATH</span><span class="pun" style="box-sizing: inherit; color: #666600;">=/</span><span class="pln" style="box-sizing: inherit; color: #000000;">usr</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="kwd" style="box-sizing: inherit; color: #000088;">local</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">sbin</span><span class="pun" style="box-sizing: inherit; color: #666600;">:/</span><span class="pln" style="box-sizing: inherit; color: #000000;">usr</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="kwd" style="box-sizing: inherit; color: #000088;">local</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">bin</span><span class="pun" style="box-sizing: inherit; color: #666600;">:/</span><span class="pln" style="box-sizing: inherit; color: #000000;">sbin</span><span class="pun" style="box-sizing: inherit; color: #666600;">:/</span><span class="pln" style="box-sizing: inherit; color: #000000;">bin</span><span class="pun" style="box-sizing: inherit; color: #666600;">:/</span><span class="pln" style="box-sizing: inherit; color: #000000;">usr</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">sbin</span><span class="pun" style="box-sizing: inherit; color: #666600;">:/</span><span class="pln" style="box-sizing: inherit; color: #000000;">usr</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">bin
clear
printf</span> <span class="str" style="box-sizing: inherit; color: #008800;">"
#######################################################################
#   </span> <span class="wp_keywordlink" style="box-sizing: inherit;">[<span class="str" style="box-sizing: inherit; color: #008800;">LNMP</span>](https://blog.linuxeye.com/31.html "LNMP")</span><span class="str" style="box-sizing: inherit; color: #008800;">/</span><span class="wp_keywordlink" style="box-sizing: inherit;">[<span class="str" style="box-sizing: inherit; color: #008800;">LAMP</span>](https://blog.linuxeye.com/82.html "LAMP")</span><span class="str" style="box-sizing: inherit; color: #008800;">/LANMP for CentOS/RadHat 5+ Debian 6+ and Ubuntu 12+    #
# For more information please visit http://blog.linuxeye.com/31.html  #
#######################################################################
"</span>

<span class="pun" style="box-sizing: inherit; color: #666600;">[</span> <span class="pun" style="box-sizing: inherit; color: #666600;">!</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">e</span> <span class="str" style="box-sizing: inherit; color: #008800;">'/usr/bin/curl'</span> <span class="pun" style="box-sizing: inherit; color: #666600;">]</span> <span class="pun" style="box-sizing: inherit; color: #666600;">&&</span> <span class="pln" style="box-sizing: inherit; color: #000000;">yum</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">y install curl

VPN_IP</span><span class="pun" style="box-sizing: inherit; color: #666600;">=</span><span class="str" style="box-sizing: inherit; color: #008800;">`curl ipv4.icanhazip.com`</span> <span class="pln" style="box-sizing: inherit; color: #000000;">VPN_USER</span><span class="pun" style="box-sizing: inherit; color: #666600;">=</span><span class="str" style="box-sizing: inherit; color: #008800;">"linuxeye"</span> <span class="pln" style="box-sizing: inherit; color: #000000;">VPN_PASS</span><span class="pun" style="box-sizing: inherit; color: #666600;">=</span><span class="str" style="box-sizing: inherit; color: #008800;">"linuxeye"</span> <span class="pln" style="box-sizing: inherit; color: #000000;">VPN_LOCAL</span><span class="pun" style="box-sizing: inherit; color: #666600;">=</span><span class="str" style="box-sizing: inherit; color: #008800;">"192.168.0.150"</span> <span class="pln" style="box-sizing: inherit; color: #000000;">VPN_REMOTE</span><span class="pun" style="box-sizing: inherit; color: #666600;">=</span><span class="str" style="box-sizing: inherit; color: #008800;">"192.168.0.151-200"</span>

<span class="kwd" style="box-sizing: inherit; color: #000088;">while</span> <span class="pun" style="box-sizing: inherit; color: #666600;">:</span>
<span class="kwd" style="box-sizing: inherit; color: #000088;">do</span> <span class="pln" style="box-sizing: inherit; color: #000000;">        echo
        read</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">p</span> <span class="str" style="box-sizing: inherit; color: #008800;">"Please input username: "</span> <span class="pln" style="box-sizing: inherit; color: #000000;">VPN_USER
       </span> <span class="pun" style="box-sizing: inherit; color: #666600;">[</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">n</span> <span class="str" style="box-sizing: inherit; color: #008800;">"$VPN_USER"</span> <span class="pun" style="box-sizing: inherit; color: #666600;">]</span> <span class="pun" style="box-sizing: inherit; color: #666600;">&&</span> <span class="kwd" style="box-sizing: inherit; color: #000088;">break</span>
<span class="kwd" style="box-sizing: inherit; color: #000088;">done</span>

<span class="kwd" style="box-sizing: inherit; color: #000088;">while</span> <span class="pun" style="box-sizing: inherit; color: #666600;">:</span>
<span class="kwd" style="box-sizing: inherit; color: #000088;">do</span> <span class="pln" style="box-sizing: inherit; color: #000000;">        echo
        read</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">p</span> <span class="str" style="box-sizing: inherit; color: #008800;">"Please input password: "</span> <span class="pln" style="box-sizing: inherit; color: #000000;">VPN_PASS
       </span> <span class="pun" style="box-sizing: inherit; color: #666600;">[</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">n</span> <span class="str" style="box-sizing: inherit; color: #008800;">"$VPN_PASS"</span> <span class="pun" style="box-sizing: inherit; color: #666600;">]</span> <span class="pun" style="box-sizing: inherit; color: #666600;">&&</span> <span class="kwd" style="box-sizing: inherit; color: #000088;">break</span>
<span class="kwd" style="box-sizing: inherit; color: #000088;">done</span> <span class="pln" style="box-sizing: inherit; color: #000000;">clear</span> <span class="kwd" style="box-sizing: inherit; color: #000088;">if</span> <span class="pun" style="box-sizing: inherit; color: #666600;">[</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">n</span> <span class="str" style="box-sizing: inherit; color: #008800;">"`grep 'CentOS</span> <span class="wp_keywordlink" style="box-sizing: inherit;">[<span class="str" style="box-sizing: inherit; color: #008800;">Linux</span>](http://www.linuxeye.com/ "Linux")</span> <span class="str" style="box-sizing: inherit; color: #008800;">release 7' /etc/redhat-release`"</span> <span class="pun" style="box-sizing: inherit; color: #666600;">];</span><span class="kwd" style="box-sizing: inherit; color: #000088;">then</span> <span class="pln" style="box-sizing: inherit; color: #000000;">       </span> <span class="com" style="box-sizing: inherit; color: #880000;">#CentOS_REL=7</span> <span class="pln" style="box-sizing: inherit; color: #000000;">    </span><span class="kwd" style="box-sizing: inherit; color: #000088;">if</span> <span class="pun" style="box-sizing: inherit; color: #666600;">[</span> <span class="pun" style="box-sizing: inherit; color: #666600;">!</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">e</span> <span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">etc</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">yum</span><span class="pun" style="box-sizing: inherit; color: #666600;">.</span><span class="pln" style="box-sizing: inherit; color: #000000;">repos</span><span class="pun" style="box-sizing: inherit; color: #666600;">.</span><span class="pln" style="box-sizing: inherit; color: #000000;">d</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">epel</span><span class="pun" style="box-sizing: inherit; color: #666600;">.</span><span class="pln" style="box-sizing: inherit; color: #000000;">repo</span> <span class="pun" style="box-sizing: inherit; color: #666600;">];</span><span class="kwd" style="box-sizing: inherit; color: #000088;">then</span> <span class="pln" style="box-sizing: inherit; color: #000000;">        cat</span> <span class="pun" style="box-sizing: inherit; color: #666600;">></span> <span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">etc</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">yum</span><span class="pun" style="box-sizing: inherit; color: #666600;">.</span><span class="pln" style="box-sizing: inherit; color: #000000;">repos</span><span class="pun" style="box-sizing: inherit; color: #666600;">.</span><span class="pln" style="box-sizing: inherit; color: #000000;">d</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">epel</span><span class="pun" style="box-sizing: inherit; color: #666600;">.</span><span class="pln" style="box-sizing: inherit; color: #000000;">repo</span> <span class="pun" style="box-sizing: inherit; color: #666600;"><<</span> <span class="pln" style="box-sizing: inherit; color: #000000;">EOF</span> <span class="pun" style="box-sizing: inherit; color: #666600;">[</span><span class="pln" style="box-sizing: inherit; color: #000000;">epel</span><span class="pun" style="box-sizing: inherit; color: #666600;">]</span> <span class="pln" style="box-sizing: inherit; color: #000000;">name</span><span class="pun" style="box-sizing: inherit; color: #666600;">=</span><span class="typ" style="box-sizing: inherit; color: #660066;">Extra</span> <span class="typ" style="box-sizing: inherit; color: #660066;">Packages</span> <span class="kwd" style="box-sizing: inherit; color: #000088;">for</span> <span class="typ" style="box-sizing: inherit; color: #660066;">Enterprise</span> <span class="typ" style="box-sizing: inherit; color: #660066;">Linux</span> <span class="lit" style="box-sizing: inherit; color: #006666;">7</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span> <span class="pln" style="box-sizing: inherit; color: #000000;">\$basearch</span> <span class="com" style="box-sizing: inherit; color: #880000;">#baseurl=http://download.fedoraproject.org/pub/epel/7/\$basearch</span> <span class="pln" style="box-sizing: inherit; color: #000000;">mirrorlist</span><span class="pun" style="box-sizing: inherit; color: #666600;">=</span><span class="pln" style="box-sizing: inherit; color: #000000;">https</span><span class="pun" style="box-sizing: inherit; color: #666600;">://</span><span class="pln" style="box-sizing: inherit; color: #000000;">mirrors</span><span class="pun" style="box-sizing: inherit; color: #666600;">.</span><span class="pln" style="box-sizing: inherit; color: #000000;">fedoraproject</span><span class="pun" style="box-sizing: inherit; color: #666600;">.</span><span class="pln" style="box-sizing: inherit; color: #000000;">org</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">metalink</span><span class="pun" style="box-sizing: inherit; color: #666600;">?</span><span class="pln" style="box-sizing: inherit; color: #000000;">repo</span><span class="pun" style="box-sizing: inherit; color: #666600;">=</span><span class="pln" style="box-sizing: inherit; color: #000000;">epel</span><span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="lit" style="box-sizing: inherit; color: #006666;">7</span><span class="pun" style="box-sizing: inherit; color: #666600;">&</span><span class="pln" style="box-sizing: inherit; color: #000000;">arch</span><span class="pun" style="box-sizing: inherit; color: #666600;">=</span><span class="pln" style="box-sizing: inherit; color: #000000;">\$basearch
failovermethod</span><span class="pun" style="box-sizing: inherit; color: #666600;">=</span><span class="pln" style="box-sizing: inherit; color: #000000;">priority
enabled</span><span class="pun" style="box-sizing: inherit; color: #666600;">=</span><span class="lit" style="box-sizing: inherit; color: #006666;">1</span> <span class="pln" style="box-sizing: inherit; color: #000000;">gpgcheck</span><span class="pun" style="box-sizing: inherit; color: #666600;">=</span><span class="lit" style="box-sizing: inherit; color: #006666;">0</span> <span class="pln" style="box-sizing: inherit; color: #000000;">EOF</span> <span class="kwd" style="box-sizing: inherit; color: #000088;">fi</span> <span class="pln" style="box-sizing: inherit; color: #000000;">       </span> <span class="kwd" style="box-sizing: inherit; color: #000088;">for</span> <span class="typ" style="box-sizing: inherit; color: #660066;">Package</span> <span class="kwd" style="box-sizing: inherit; color: #000088;">in</span> <span class="pln" style="box-sizing: inherit; color: #000000;">wget make openssl gcc</span><span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">c</span><span class="pun" style="box-sizing: inherit; color: #666600;">++</span> <span class="pln" style="box-sizing: inherit; color: #000000;">ppp pptpd iptables iptables</span><span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">services
       </span> <span class="kwd" style="box-sizing: inherit; color: #000088;">do</span> <span class="pln" style="box-sizing: inherit; color: #000000;">                yum</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">y install $Package
       </span> <span class="kwd" style="box-sizing: inherit; color: #000088;">done</span> <span class="pln" style="box-sizing: inherit; color: #000000;">        echo</span> <span class="str" style="box-sizing: inherit; color: #008800;">'net.ipv4.ip_forward = 1'</span> <span class="pun" style="box-sizing: inherit; color: #666600;">>></span> <span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">etc</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">sysctl</span><span class="pun" style="box-sizing: inherit; color: #666600;">.</span><span class="pln" style="box-sizing: inherit; color: #000000;">conf</span> <span class="kwd" style="box-sizing: inherit; color: #000088;">elif</span> <span class="pun" style="box-sizing: inherit; color: #666600;">[</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">n</span> <span class="str" style="box-sizing: inherit; color: #008800;">"`grep 'CentOS release 6' /etc/redhat-release`"</span> <span class="pun" style="box-sizing: inherit; color: #666600;">];</span><span class="kwd" style="box-sizing: inherit; color: #000088;">then</span> <span class="pln" style="box-sizing: inherit; color: #000000;">       </span> <span class="com" style="box-sizing: inherit; color: #880000;">#CentOS_REL=6</span> <span class="pln" style="box-sizing: inherit; color: #000000;">       </span> <span class="kwd" style="box-sizing: inherit; color: #000088;">for</span> <span class="typ" style="box-sizing: inherit; color: #660066;">Package</span> <span class="kwd" style="box-sizing: inherit; color: #000088;">in</span> <span class="pln" style="box-sizing: inherit; color: #000000;">wget make openssl gcc</span><span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">c</span><span class="pun" style="box-sizing: inherit; color: #666600;">++</span> <span class="pln" style="box-sizing: inherit; color: #000000;">iptables ppp
       </span> <span class="kwd" style="box-sizing: inherit; color: #000088;">do</span> <span class="pln" style="box-sizing: inherit; color: #000000;">                yum</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">y install $Package
       </span> <span class="kwd" style="box-sizing: inherit; color: #000088;">done</span> <span class="pln" style="box-sizing: inherit; color: #000000;">    sed</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">i</span> <span class="str" style="box-sizing: inherit; color: #008800;">'s@net.ipv4.ip_forward.*@net.ipv4.ip_forward = 1@g'</span> <span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">etc</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">sysctl</span><span class="pun" style="box-sizing: inherit; color: #666600;">.</span><span class="pln" style="box-sizing: inherit; color: #000000;">conf
    rpm</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="typ" style="box-sizing: inherit; color: #660066;">Uvh</span> <span class="pln" style="box-sizing: inherit; color: #000000;">http</span><span class="pun" style="box-sizing: inherit; color: #666600;">://</span><span class="pln" style="box-sizing: inherit; color: #000000;">poptop</span><span class="pun" style="box-sizing: inherit; color: #666600;">.</span><span class="pln" style="box-sizing: inherit; color: #000000;">sourceforge</span><span class="pun" style="box-sizing: inherit; color: #666600;">.</span><span class="pln" style="box-sizing: inherit; color: #000000;">net</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">yum</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">stable</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">rhel6</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">pptp</span><span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">release</span><span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">current</span><span class="pun" style="box-sizing: inherit; color: #666600;">.</span><span class="pln" style="box-sizing: inherit; color: #000000;">noarch</span><span class="pun" style="box-sizing: inherit; color: #666600;">.</span><span class="pln" style="box-sizing: inherit; color: #000000;">rpm
    yum</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">y install pptpd</span> <span class="kwd" style="box-sizing: inherit; color: #000088;">else</span> <span class="pln" style="box-sizing: inherit; color: #000000;">        echo</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">e</span> <span class="str" style="box-sizing: inherit; color: #008800;">"\033[31mDoes not support this OS, Please contact the author! \033[0m"</span> <span class="pln" style="box-sizing: inherit; color: #000000;">        exit</span> <span class="lit" style="box-sizing: inherit; color: #006666;">1</span>
<span class="kwd" style="box-sizing: inherit; color: #000088;">fi</span> <span class="pln" style="box-sizing: inherit; color: #000000;">echo</span> <span class="str" style="box-sizing: inherit; color: #008800;">"1"</span> <span class="pun" style="box-sizing: inherit; color: #666600;">></span> <span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">proc</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">sys</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">net</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">ipv4</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">ip_forward

sysctl</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">p</span> <span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">etc</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">sysctl</span><span class="pun" style="box-sizing: inherit; color: #666600;">.</span><span class="pln" style="box-sizing: inherit; color: #000000;">conf</span> <span class="pun" style="box-sizing: inherit; color: #666600;">[</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">z</span> <span class="str" style="box-sizing: inherit; color: #008800;">"`grep '^localip' /etc/pptpd.conf`"</span> <span class="pun" style="box-sizing: inherit; color: #666600;">]</span> <span class="pun" style="box-sizing: inherit; color: #666600;">&&</span> <span class="pln" style="box-sizing: inherit; color: #000000;">echo</span> <span class="str" style="box-sizing: inherit; color: #008800;">"localip $VPN_LOCAL"</span> <span class="pun" style="box-sizing: inherit; color: #666600;">>></span> <span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">etc</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">pptpd</span><span class="pun" style="box-sizing: inherit; color: #666600;">.</span><span class="pln" style="box-sizing: inherit; color: #000000;">conf</span> <span class="com" style="box-sizing: inherit; color: #880000;"># Local IP address of your VPN server</span>
<span class="pun" style="box-sizing: inherit; color: #666600;">[</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">z</span> <span class="str" style="box-sizing: inherit; color: #008800;">"`grep '^remoteip' /etc/pptpd.conf`"</span> <span class="pun" style="box-sizing: inherit; color: #666600;">]</span> <span class="pun" style="box-sizing: inherit; color: #666600;">&&</span> <span class="pln" style="box-sizing: inherit; color: #000000;">echo</span> <span class="str" style="box-sizing: inherit; color: #008800;">"remoteip $VPN_REMOTE"</span> <span class="pun" style="box-sizing: inherit; color: #666600;">>></span> <span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">etc</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">pptpd</span><span class="pun" style="box-sizing: inherit; color: #666600;">.</span><span class="pln" style="box-sizing: inherit; color: #000000;">conf</span> <span class="com" style="box-sizing: inherit; color: #880000;"># Scope for your home network</span>

<span class="kwd" style="box-sizing: inherit; color: #000088;">if</span> <span class="pun" style="box-sizing: inherit; color: #666600;">[</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">z</span> <span class="str" style="box-sizing: inherit; color: #008800;">"`grep '^ms-dns' /etc/ppp/options.pptpd`"</span> <span class="pun" style="box-sizing: inherit; color: #666600;">];</span><span class="kwd" style="box-sizing: inherit; color: #000088;">then</span> <span class="pln" style="box-sizing: inherit; color: #000000;">    echo</span> <span class="str" style="box-sizing: inherit; color: #008800;">"ms-dns 8.8.8.8"</span> <span class="pun" style="box-sizing: inherit; color: #666600;">>></span> <span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">etc</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">ppp</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">options</span><span class="pun" style="box-sizing: inherit; color: #666600;">.</span><span class="pln" style="box-sizing: inherit; color: #000000;">pptpd</span> <span class="com" style="box-sizing: inherit; color: #880000;"># Google DNS Primary</span> <span class="pln" style="box-sizing: inherit; color: #000000;">    echo</span> <span class="str" style="box-sizing: inherit; color: #008800;">"ms-dns 209.244.0.3"</span> <span class="pun" style="box-sizing: inherit; color: #666600;">>></span> <span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">etc</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">ppp</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">options</span><span class="pun" style="box-sizing: inherit; color: #666600;">.</span><span class="pln" style="box-sizing: inherit; color: #000000;">pptpd</span> <span class="com" style="box-sizing: inherit; color: #880000;"># Level3 Primary</span> <span class="pln" style="box-sizing: inherit; color: #000000;">    echo</span> <span class="str" style="box-sizing: inherit; color: #008800;">"ms-dns 208.67.222.222"</span> <span class="pun" style="box-sizing: inherit; color: #666600;">>></span> <span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">etc</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">ppp</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">options</span><span class="pun" style="box-sizing: inherit; color: #666600;">.</span><span class="pln" style="box-sizing: inherit; color: #000000;">pptpd</span> <span class="com" style="box-sizing: inherit; color: #880000;"># OpenDNS Primary</span>
<span class="kwd" style="box-sizing: inherit; color: #000088;">fi</span> <span class="pln" style="box-sizing: inherit; color: #000000;">echo</span> <span class="str" style="box-sizing: inherit; color: #008800;">"$VPN_USER pptpd $VPN_PASS *"</span> <span class="pun" style="box-sizing: inherit; color: #666600;">>></span> <span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">etc</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">ppp</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">chap</span><span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">secrets

ETH</span><span class="pun" style="box-sizing: inherit; color: #666600;">=</span><span class="str" style="box-sizing: inherit; color: #008800;">`route | grep default | awk '{print $NF}'`</span>
<span class="pun" style="box-sizing: inherit; color: #666600;">[</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">z</span> <span class="str" style="box-sizing: inherit; color: #008800;">"`grep '1723 -j ACCEPT' /etc/sysconfig/iptables`"</span> <span class="pun" style="box-sizing: inherit; color: #666600;">]</span> <span class="pun" style="box-sizing: inherit; color: #666600;">&&</span> <span class="pln" style="box-sizing: inherit; color: #000000;">iptables</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">I INPUT</span> <span class="lit" style="box-sizing: inherit; color: #006666;">4</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">p tcp</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">m state</span> <span class="pun" style="box-sizing: inherit; color: #666600;">--</span><span class="pln" style="box-sizing: inherit; color: #000000;">state NEW</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">m tcp</span> <span class="pun" style="box-sizing: inherit; color: #666600;">--</span><span class="pln" style="box-sizing: inherit; color: #000000;">dport</span> <span class="lit" style="box-sizing: inherit; color: #006666;">1723</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">j ACCEPT</span> <span class="pun" style="box-sizing: inherit; color: #666600;">[</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">z</span> <span class="str" style="box-sizing: inherit; color: #008800;">"`grep 'gre -j ACCEPT' /etc/sysconfig/iptables`"</span> <span class="pun" style="box-sizing: inherit; color: #666600;">]</span> <span class="pun" style="box-sizing: inherit; color: #666600;">&&</span> <span class="pln" style="box-sizing: inherit; color: #000000;">iptables</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">I INPUT</span> <span class="lit" style="box-sizing: inherit; color: #006666;">5</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">p gre</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">j ACCEPT
iptables</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">t nat</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">A POSTROUTING</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">o $ETH</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">j MASQUERADE
service iptables save
sed</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">i</span> <span class="str" style="box-sizing: inherit; color: #008800;">'s@^-A INPUT -j REJECT --reject-with icmp-host-prohibited@#-A INPUT -j REJECT --reject-with icmp-host-prohibited@'</span> <span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">etc</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">sysconfig</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">iptables
sed</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">i</span> <span class="str" style="box-sizing: inherit; color: #008800;">'s@^-A FORWARD -j REJECT --reject-with icmp-host-prohibited@#-A FORWARD -j REJECT --reject-with icmp-host-prohibited@'</span> <span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">etc</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">sysconfig</span><span class="pun" style="box-sizing: inherit; color: #666600;">/</span><span class="pln" style="box-sizing: inherit; color: #000000;">iptables
service iptables restart

service pptpd restart
chkconfig pptpd on
clear

echo</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">e</span> <span class="str" style="box-sizing: inherit; color: #008800;">"You can now connect to your VPN via your external IP \033[32m${VPN_IP}\033[0m"</span> <span class="pln" style="box-sizing: inherit; color: #000000;">echo</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">e</span> <span class="str" style="box-sizing: inherit; color: #008800;">"Username: \033[32m${VPN_USER}\033[0m"</span> <span class="pln" style="box-sizing: inherit; color: #000000;">echo</span> <span class="pun" style="box-sizing: inherit; color: #666600;">-</span><span class="pln" style="box-sizing: inherit; color: #000000;">e</span> <span class="str" style="box-sizing: inherit; color: #008800;">"Password: \033[32m${VPN_PASS}\033[0m"</span></pre>
